<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Synchronous Client &#8212; stompest documentation - v2.3.0</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Asynchronous Client" href="async.html" />
    <link rel="prev" title="Contents" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="async.html" title="Asynchronous Client"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Contents"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">stompest documentation - v2.3.0</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Synchronous Client</a><ul>
<li><a class="reference internal" href="#module-stompest.sync.examples">Examples</a><ul>
<li><a class="reference internal" href="#producer">Producer</a></li>
<li><a class="reference internal" href="#consumer">Consumer</a></li>
<li><a class="reference internal" href="#tls-ssl-consumer">TLS/SSL Consumer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Contents</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="async.html"
                        title="next chapter">Asynchronous Client</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/sync.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-stompest.sync.client">
<span id="synchronous-client"></span><span id="sync"></span><h1>Synchronous Client<a class="headerlink" href="#module-stompest.sync.client" title="Permalink to this headline">¶</a></h1>
<p>The synchronous client is dead simple. It does not assume anything about your concurrency model (thread vs process) or force you to use it any particular way. It gets out of your way and lets you do what you want.</p>
<div class="section" id="module-stompest.sync.examples">
<span id="examples"></span><h2>Examples<a class="headerlink" href="#module-stompest.sync.examples" title="Permalink to this headline">¶</a></h2>
<p>If you use ActiveMQ to run these examples, make sure you enable the STOMP connector, (see <a class="reference external" href="http://activemq.apache.org/stomp.html">here</a> for details):</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- add this to the config file &quot;activemq.xml&quot; --&gt;</span>
<span class="nt">&lt;transportConnector</span> <span class="na">name=</span><span class="s">&quot;stomp&quot;</span> <span class="na">uri=</span><span class="s">&quot;stomp://0.0.0.0:61613&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>For debugging purposes, it is highly recommended to turn on the logger on level <code class="xref py py-attr docutils literal"><span class="pre">DEBUG</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="producer">
<h3>Producer<a class="headerlink" href="#producer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stompest.config</span> <span class="k">import</span> <span class="n">StompConfig</span>
<span class="kn">from</span> <span class="nn">stompest.sync</span> <span class="k">import</span> <span class="n">Stomp</span>

<span class="n">CONFIG</span> <span class="o">=</span> <span class="n">StompConfig</span><span class="p">(</span><span class="s1">&#39;tcp://localhost:61613&#39;</span><span class="p">)</span>
<span class="n">QUEUE</span> <span class="o">=</span> <span class="s1">&#39;/queue/test&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Stomp</span><span class="p">(</span><span class="n">CONFIG</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">QUEUE</span><span class="p">,</span> <span class="s1">&#39;test message 1&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">QUEUE</span><span class="p">,</span> <span class="s1">&#39;test message 2&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="consumer">
<h3>Consumer<a class="headerlink" href="#consumer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stompest.config</span> <span class="k">import</span> <span class="n">StompConfig</span>
<span class="kn">from</span> <span class="nn">stompest.protocol</span> <span class="k">import</span> <span class="n">StompSpec</span>
<span class="kn">from</span> <span class="nn">stompest.sync</span> <span class="k">import</span> <span class="n">Stomp</span>

<span class="n">CONFIG</span> <span class="o">=</span> <span class="n">StompConfig</span><span class="p">(</span><span class="s1">&#39;tcp://localhost:61613&#39;</span><span class="p">)</span>
<span class="n">QUEUE</span> <span class="o">=</span> <span class="s1">&#39;/queue/test&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Stomp</span><span class="p">(</span><span class="n">CONFIG</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">QUEUE</span><span class="p">,</span> <span class="p">{</span><span class="n">StompSpec</span><span class="o">.</span><span class="n">ACK_HEADER</span><span class="p">:</span> <span class="n">StompSpec</span><span class="o">.</span><span class="n">ACK_CLIENT_INDIVIDUAL</span><span class="p">})</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">receiveFrame</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">frame</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
        <span class="n">client</span><span class="o">.</span><span class="n">ack</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="tls-ssl-consumer">
<h3>TLS/SSL Consumer<a class="headerlink" href="#tls-ssl-consumer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">from</span> <span class="nn">stompest.config</span> <span class="k">import</span> <span class="n">StompConfig</span>
<span class="kn">from</span> <span class="nn">stompest.protocol</span> <span class="k">import</span> <span class="n">StompSpec</span>
<span class="kn">from</span> <span class="nn">stompest.sync</span> <span class="k">import</span> <span class="n">Stomp</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="c1"># Disable cert validation for demo only</span>
<span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>

<span class="n">CONFIG</span> <span class="o">=</span> <span class="n">StompConfig</span><span class="p">(</span><span class="s1">&#39;ssl://localhost:61612&#39;</span><span class="p">,</span> <span class="n">sslContext</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<span class="n">QUEUE</span> <span class="o">=</span> <span class="s1">&#39;/queue/test&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Stomp</span><span class="p">(</span><span class="n">CONFIG</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">QUEUE</span><span class="p">,</span> <span class="p">{</span><span class="n">StompSpec</span><span class="o">.</span><span class="n">ACK_HEADER</span><span class="p">:</span> <span class="n">StompSpec</span><span class="o">.</span><span class="n">ACK_CLIENT_INDIVIDUAL</span><span class="p">})</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">receiveFrame</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">frame</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
        <span class="n">client</span><span class="o">.</span><span class="n">ack</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
<p>An SSL producer would be configured in the same way. The configuration
of an SSL-enabled ActiveMQ server is somewhat complicated. The config
file for ActiveMQ, <code class="docutils literal"><span class="pre">activemq.xml</span></code>, must have the following additions:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- add this to the config file &quot;activemq.xml&quot; --&gt;</span>
<span class="nt">&lt;sslContext&gt;</span>
    <span class="nt">&lt;sslContext</span>
        <span class="na">keyStore=</span><span class="s">&quot;broker.ks&quot;</span> <span class="na">keyStorePassword=</span><span class="s">&quot;password&quot;</span>
        <span class="na">trustStore=</span><span class="s">&quot;client.ts&quot;</span> <span class="na">trustStorePassword=</span><span class="s">&quot;password&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/sslContext&gt;</span>
<span class="nt">&lt;transportConnectors&gt;</span>
    <span class="nt">&lt;transportConnector</span> <span class="na">name=</span><span class="s">&quot;stomp+ssl&quot;</span> <span class="na">uri=</span><span class="s">&quot;stomp+ssl://0.0.0.0:61612&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transportConnector</span> <span class="na">name=</span><span class="s">&quot;stomp&quot;</span> <span class="na">uri=</span><span class="s">&quot;stomp://0.0.0.0:61613&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/transportConnectors&gt;</span>
</pre></div>
</div>
<p>The SSL transport configuration (on port 61612) is shown alongside the standard
STOMP configuration (on port 61613) for contrast. More about the required ActiveMQ setup,
as well as instructions to generate the files <code class="docutils literal"><span class="pre">broker.ks</span></code> and <code class="docutils literal"><span class="pre">client.ts</span></code> may
be found in the ActiveMQ documentation under
<a class="reference external" href="http://activemq.apache.org/how-do-i-use-ssl.html">How do I use SSL</a>.</p>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="stompest.sync.client.Stomp">
<em class="property">class </em><code class="descclassname">stompest.sync.client.</code><code class="descname">Stomp</code><span class="sig-paren">(</span><em>config</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp" title="Permalink to this definition">¶</a></dt>
<dd><p>A synchronous STOMP client. This is the successor of the simple STOMP client in stompest 1.x, but the API is not backward compatible.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>config</strong> &#8211; A <a class="reference internal" href="config.html#stompest.config.StompConfig" title="stompest.config.StompConfig"><code class="xref py py-class docutils literal"><span class="pre">StompConfig</span></code></a> object</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="config.html#stompest.config.StompConfig" title="stompest.config.StompConfig"><code class="xref py py-class docutils literal"><span class="pre">StompConfig</span></code></a> for how to set session configuration options, <a class="reference internal" href="protocol.html#stompest.protocol.session.StompSession" title="stompest.protocol.session.StompSession"><code class="xref py py-class docutils literal"><span class="pre">StompSession</span></code></a> for session state, <a class="reference internal" href="protocol.html#module-stompest.protocol.commands" title="stompest.protocol.commands"><code class="xref py py-mod docutils literal"><span class="pre">protocol.commands</span></code></a> for all API options which are documented here.</p>
</div>
<dl class="method">
<dt id="stompest.sync.client.Stomp.abort">
<code class="descname">abort</code><span class="sig-paren">(</span><em>transaction=None</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.abort" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an <strong>ABORT</strong> frame to abort a STOMP transaction.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.ack">
<code class="descname">ack</code><span class="sig-paren">(</span><em>frame</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.ack" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an <strong>ACK</strong> frame for a received <strong>MESSAGE</strong> frame.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.beat">
<code class="descname">beat</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.beat" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a STOMP heart-beat.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># you might want to enable logging to trace the wire-level traffic</span>
<span class="gp">... </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">Stomp</span><span class="p">(</span><span class="n">StompConfig</span><span class="p">(</span><span class="s1">&#39;tcp://localhost:61613&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">StompSpec</span><span class="o">.</span><span class="n">VERSION_1_1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">heartBeats</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">elapsed</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span> <span class="o">=</span> <span class="kc">None</span><span class="p">:</span> <span class="p">(</span><span class="n">t</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">-</span> <span class="n">start</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">times</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s1">&#39;elapsed: </span><span class="si">%.2f</span><span class="s1">, last received: </span><span class="si">%.2f</span><span class="s1">, last sent: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">elapsed</span><span class="p">(),</span> <span class="n">elapsed</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">lastReceived</span><span class="p">),</span> <span class="n">elapsed</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">lastSent</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">elapsed</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">client</span><span class="o">.</span><span class="n">clientHeartBeat</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">client</span><span class="o">.</span><span class="n">canRead</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">client</span><span class="o">.</span><span class="n">serverHeartBeat</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="c1"># poll server heart-beats</span>
<span class="gp">... </span>    <span class="n">client</span><span class="o">.</span><span class="n">beat</span><span class="p">()</span> <span class="c1"># send client heart-beat</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="n">times</span><span class="p">()</span>
<span class="gp">... </span>
<span class="go">False</span>
<span class="go">elapsed: 0.08, last received: 0.00, last sent: 0.08</span>
<span class="go">False</span>
<span class="go">elapsed: 0.17, last received: 0.00, last sent: 0.17</span>
<span class="go">False</span>
<span class="go">elapsed: 0.25, last received: 0.20, last sent: 0.25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">canRead</span><span class="p">()</span> <span class="c1"># server will disconnect us because we&#39;re not heart-beating any more</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">stompest.error.StompConnectionError</span>: <span class="n">Connection closed [No more data]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">times</span><span class="p">()</span>
<span class="go">elapsed: 0.50, last received: 0.50, last sent: 0.25</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.begin">
<code class="descname">begin</code><span class="sig-paren">(</span><em>transaction=None</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <strong>BEGIN</strong> frame to begin a STOMP transaction.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.canRead">
<code class="descname">canRead</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.canRead" title="Permalink to this definition">¶</a></dt>
<dd><p>Tell whether there is an incoming STOMP frame available for us to read.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>timeout</strong> &#8211; This is the time (in seconds) to wait for a frame to become available. If <code class="xref py py-obj docutils literal"><span class="pre">None</span></code>, we will wait indefinitely.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the wire-level connection is not available, this method will raise a <a class="reference internal" href="error.html#stompest.error.StompConnectionError" title="stompest.error.StompConnectionError"><code class="xref py py-class docutils literal"><span class="pre">StompConnectionError</span></code></a>!</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="stompest.sync.client.Stomp.clientHeartBeat">
<code class="descname">clientHeartBeat</code><a class="headerlink" href="#stompest.sync.client.Stomp.clientHeartBeat" title="Permalink to this definition">¶</a></dt>
<dd><p>The negotiated client heart-beat period in ms.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.close">
<code class="descname">close</code><span class="sig-paren">(</span><em>flush=True</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close both the client&#8217;s <a class="reference internal" href="#stompest.sync.client.Stomp.session" title="stompest.sync.client.Stomp.session"><code class="xref py py-attr docutils literal"><span class="pre">session</span></code></a> and transport (that is, the wire-level connection with the broker).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>flush</strong> &#8211; Decides whether the <a class="reference internal" href="#stompest.sync.client.Stomp.session" title="stompest.sync.client.Stomp.session"><code class="xref py py-attr docutils literal"><span class="pre">session</span></code></a> should forget its active subscriptions or not.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do not flush the subscriptions, they will be replayed upon this client&#8217;s next <a class="reference internal" href="#stompest.sync.client.Stomp.connect" title="stompest.sync.client.Stomp.connect"><code class="xref py py-meth docutils literal"><span class="pre">connect()</span></code></a>!</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><em>transaction=None</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <strong>COMMIT</strong> frame to commit a STOMP transaction.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><em>headers=None</em>, <em>versions=None</em>, <em>host=None</em>, <em>heartBeats=None</em>, <em>connectTimeout=None</em>, <em>connectedTimeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Establish a connection to a STOMP broker. If the wire-level connect fails, attempt a failover according to the settings in the client&#8217;s <a class="reference internal" href="config.html#stompest.config.StompConfig" title="stompest.config.StompConfig"><code class="xref py py-class docutils literal"><span class="pre">StompConfig</span></code></a> object. If there are active subscriptions in the <a class="reference internal" href="#stompest.sync.client.Stomp.session" title="stompest.sync.client.Stomp.session"><code class="xref py py-attr docutils literal"><span class="pre">session</span></code></a>, replay them when the STOMP connection is established.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>versions</strong> &#8211; The STOMP protocol versions we wish to support. The default behavior (<code class="xref py py-obj docutils literal"><span class="pre">None</span></code>) is the same as for the <a class="reference internal" href="protocol.html#stompest.protocol.commands.connect" title="stompest.protocol.commands.connect"><code class="xref py py-func docutils literal"><span class="pre">connect()</span></code></a> function of the commands API, but the highest supported version will be the one you specified in the <a class="reference internal" href="config.html#stompest.config.StompConfig" title="stompest.config.StompConfig"><code class="xref py py-class docutils literal"><span class="pre">StompConfig</span></code></a> object. The version which is valid for the connection about to be initiated will be stored in the <a class="reference internal" href="#stompest.sync.client.Stomp.session" title="stompest.sync.client.Stomp.session"><code class="xref py py-attr docutils literal"><span class="pre">session</span></code></a>.</li>
<li><strong>connectTimeout</strong> &#8211; This is the time (in seconds) to wait for the wire-level connection to be established. If <code class="xref py py-obj docutils literal"><span class="pre">None</span></code>, we will wait indefinitely.</li>
<li><strong>connectedTimeout</strong> &#8211; This is the time (in seconds) to wait for the STOMP connection to be established (that is, the broker&#8217;s <strong>CONNECTED</strong> frame to arrive). If <code class="xref py py-obj docutils literal"><span class="pre">None</span></code>, we will wait indefinitely.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">Stomp</span><span class="p">(</span><span class="n">StompConfig</span><span class="p">(</span><span class="s1">&#39;tcp://localhost:61613&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">StompSpec</span><span class="o">.</span><span class="n">VERSION_1_1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">version</span>
<span class="go">&#39;1.1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">versions</span><span class="o">=</span><span class="p">[</span><span class="n">StompSpec</span><span class="o">.</span><span class="n">VERSION_1_0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">version</span>
<span class="go">&#39;1.0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">version</span>
<span class="go">&#39;1.1&#39;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The <a class="reference internal" href="protocol.html#module-stompest.protocol.failover" title="stompest.protocol.failover"><code class="xref py py-mod docutils literal"><span class="pre">protocol.failover</span></code></a> and <a class="reference internal" href="protocol.html#module-stompest.protocol.session" title="stompest.protocol.session"><code class="xref py py-mod docutils literal"><span class="pre">protocol.session</span></code></a> modules for the details of subscription replay and failover transport.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.disconnect">
<code class="descname">disconnect</code><span class="sig-paren">(</span><em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a STOMP <strong>DISCONNECT</strong> command and terminate the STOMP connection.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Calling this method will clear the session&#8217;s active subscriptions unless you request a <strong>RECEIPT</strong> response from the broker. In the latter case, you have to disconnect the wire-level connection and flush the subscriptions yourself by calling <code class="docutils literal"><span class="pre">self.close(flush=True)</span></code>.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="stompest.sync.client.Stomp.lastReceived">
<code class="descname">lastReceived</code><a class="headerlink" href="#stompest.sync.client.Stomp.lastReceived" title="Permalink to this definition">¶</a></dt>
<dd><p>The last time when data was received.</p>
</dd></dl>

<dl class="attribute">
<dt id="stompest.sync.client.Stomp.lastSent">
<code class="descname">lastSent</code><a class="headerlink" href="#stompest.sync.client.Stomp.lastSent" title="Permalink to this definition">¶</a></dt>
<dd><p>The last time when data was sent.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.message">
<code class="descname">message</code><span class="sig-paren">(</span><em>frame</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.message" title="Permalink to this definition">¶</a></dt>
<dd><p>If you received a <strong>MESSAGE</strong> frame, this method will produce a token which allows you to match it against its subscription.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>frame</strong> &#8211; a <strong>MESSAGE</strong> frame.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the client is not aware of the subscription, or if we are not connected, this method will raise a <a class="reference internal" href="error.html#stompest.error.StompProtocolError" title="stompest.error.StompProtocolError"><code class="xref py py-class docutils literal"><span class="pre">StompProtocolError</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.nack">
<code class="descname">nack</code><span class="sig-paren">(</span><em>frame</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.nack" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <strong>NACK</strong> frame for a received <strong>MESSAGE</strong> frame.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.receipt">
<code class="descname">receipt</code><span class="sig-paren">(</span><em>frame</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.receipt" title="Permalink to this definition">¶</a></dt>
<dd><p>If you received a <strong>RECEIPT</strong> frame, this method will extract the receipt id which you employed to request that receipt.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>frame</strong> &#8211; A <strong>MESSAGE</strong> frame (a <a class="reference internal" href="protocol.html#stompest.protocol.frame.StompFrame" title="stompest.protocol.frame.StompFrame"><code class="xref py py-class docutils literal"><span class="pre">StompFrame</span></code></a> object).</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the client is not aware of the outstanding receipt, this method will raise a <a class="reference internal" href="error.html#stompest.error.StompProtocolError" title="stompest.error.StompProtocolError"><code class="xref py py-class docutils literal"><span class="pre">StompProtocolError</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.receiveFrame">
<code class="descname">receiveFrame</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.receiveFrame" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the next available frame.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If we are not connected, this method will raise a <a class="reference internal" href="error.html#stompest.error.StompConnectionError" title="stompest.error.StompConnectionError"><code class="xref py py-class docutils literal"><span class="pre">StompConnectionError</span></code></a>. Keep in mind that this method will block forever if there are no frames incoming on the wire. Be sure to use peek with <code class="docutils literal"><span class="pre">self.canRead(timeout)</span></code> before!</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.send">
<code class="descname">send</code><span class="sig-paren">(</span><em>destination</em>, <em>body=b''</em>, <em>headers=None</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <strong>SEND</strong> frame.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.sendFrame">
<code class="descname">sendFrame</code><span class="sig-paren">(</span><em>frame</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.sendFrame" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a raw STOMP frame.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>frame</strong> &#8211; Any STOMP frame (represented as a <a class="reference internal" href="protocol.html#stompest.protocol.frame.StompFrame" title="stompest.protocol.frame.StompFrame"><code class="xref py py-class docutils literal"><span class="pre">StompFrame</span></code></a> object).</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If we are not connected, this method, and all other API commands for sending STOMP frames except <a class="reference internal" href="#stompest.sync.client.Stomp.connect" title="stompest.sync.client.Stomp.connect"><code class="xref py py-meth docutils literal"><span class="pre">connect()</span></code></a>, will raise a <a class="reference internal" href="error.html#stompest.error.StompConnectionError" title="stompest.error.StompConnectionError"><code class="xref py py-class docutils literal"><span class="pre">StompConnectionError</span></code></a>. Use this command only if you have to bypass the <a class="reference internal" href="protocol.html#stompest.protocol.session.StompSession" title="stompest.protocol.session.StompSession"><code class="xref py py-class docutils literal"><span class="pre">StompSession</span></code></a> logic and you know what you&#8217;re doing!</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="stompest.sync.client.Stomp.serverHeartBeat">
<code class="descname">serverHeartBeat</code><a class="headerlink" href="#stompest.sync.client.Stomp.serverHeartBeat" title="Permalink to this definition">¶</a></dt>
<dd><p>The negotiated server heart-beat period in ms.</p>
</dd></dl>

<dl class="attribute">
<dt id="stompest.sync.client.Stomp.session">
<code class="descname">session</code><a class="headerlink" href="#stompest.sync.client.Stomp.session" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="protocol.html#stompest.protocol.session.StompSession" title="stompest.protocol.session.StompSession"><code class="xref py py-class docutils literal"><span class="pre">StompSession</span></code></a> associated to this client.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.subscribe">
<code class="descname">subscribe</code><span class="sig-paren">(</span><em>destination</em>, <em>headers=None</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <strong>SUBSCRIBE</strong> frame to subscribe to a STOMP destination. This method returns a token which you have to keep if you wish to match incoming <strong>MESSAGE</strong> frames to this subscription or to <a class="reference internal" href="#stompest.sync.client.Stomp.unsubscribe" title="stompest.sync.client.Stomp.unsubscribe"><code class="xref py py-meth docutils literal"><span class="pre">unsubscribe()</span></code></a> later.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.transaction">
<code class="descname">transaction</code><span class="sig-paren">(</span><em>transaction=None</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>A context manager for STOMP transactions. Upon entering the <code class="xref py py-obj docutils literal"><span class="pre">with</span></code> block, a transaction will be begun and upon exiting, that transaction will be committed or (if an error occurred) aborted.</p>
<p><strong>Example:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">Stomp</span><span class="p">(</span><span class="n">StompConfig</span><span class="p">(</span><span class="s1">&#39;tcp://localhost:61613&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;/queue/test&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ack&#39;</span><span class="p">:</span> <span class="s1">&#39;client-individual&#39;</span><span class="p">})</span>
<span class="go">(&#39;destination&#39;, &#39;/queue/test&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">canRead</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Check that queue is empty.</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="n">receipt</span><span class="o">=</span><span class="s1">&#39;important&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">transaction</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;/queue/test&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;message with transaction header&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">StompSpec</span><span class="o">.</span><span class="n">TRANSACTION_HEADER</span><span class="p">:</span> <span class="n">transaction</span><span class="p">})</span>
<span class="gp">... </span>    <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;/queue/test&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;message without transaction header&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;poof&#39;</span><span class="p">)</span>
<span class="gp">... </span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">4</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">RuntimeError</span>: <span class="n">poof</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">receiveFrame</span><span class="p">()</span>
<span class="go">StompFrame(command=&#39;RECEIPT&#39;, headers={&#39;receipt-id&#39;: &#39;important-begin&#39;})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">receiveFrame</span><span class="p">()</span>
<span class="go">StompFrame(command=&#39;RECEIPT&#39;, headers={&#39;receipt-id&#39;: &#39;important-abort&#39;})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">frame</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">receiveFrame</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">frame</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">body</span>
<span class="go">(&#39;MESSAGE&#39;, b&#39;message without transaction header&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">ack</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">canRead</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># frame with transaction header was dropped by the broker</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.sync.client.Stomp.unsubscribe">
<code class="descname">unsubscribe</code><span class="sig-paren">(</span><em>token</em>, <em>receipt=None</em><span class="sig-paren">)</span><a class="headerlink" href="#stompest.sync.client.Stomp.unsubscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an <strong>UNSUBSCRIBE</strong> frame to terminate an existing subscription.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="async.html" title="Asynchronous Client"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Contents"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">stompest documentation - v2.3.0</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Jan Müller.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>